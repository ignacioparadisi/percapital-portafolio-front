<div class="container">
  <div class="header">
    <H1>Dashboard</H1>
  </div>

  <div class="row">
    <mat-card>
      <mat-card-title>Cargar Archivo</mat-card-title>
      <mat-card-content>
        Puedes cargar un archivo tipo CSV y JSON para insertar valores que han tenido las acciones a lo largo del tiempo.
        <br/>
        <button mat-button color="primary" (click)="downloadCSVDocument()">Descargar archivo CSV ejemplo</button>
        <button mat-button color="primary" (click)="downloadJSONDocument()">Descargar archivo JSON ejemplo</button>

        <div class="dropzone">
          <input type="file" #fileDropRef id="fileDropRef" accept=".json, .csv" (change)="setSelectedFile($event)"/>
          <h3>Arrastra el archivo</h3>
          <h3>o</h3>
          <button mat-raised-button color="primary">Buscar archivo</button>
        </div>
      </mat-card-content>
      <mat-card-actions align="end">
        <button mat-raised-button color="primary" (click)="uploadDocument()" [disabled]="false">Cargar</button>
      </mat-card-actions>
    </mat-card>
  </div>

  <br/>

  <div class="row">
    <mat-card>
      <div class="center loading-shade" *ngIf="isLoading || errorLoading">
        <button *ngIf="errorLoading" mat-raised-button color="warn" (click)="fetchStocksFromBVC()">Reintentar</button>
        <mat-spinner *ngIf="isLoading"></mat-spinner>
      </div>
      <mat-card-title>Últimos Precios</mat-card-title>
      <mat-card-content>
        <p *ngIf="latestsStocks.length === 0 && !isLoading && !errorLoading" class="center">No se han cargado precios hoy</p>
        <div  *ngIf="latestsStocks.length > 0" class="table-container mat-elevation-z8">
          <div class="table-data-container">
            <mat-table [dataSource]="dataSource">
              <ng-container matColumnDef="symbol">
                <mat-header-cell *matHeaderCellDef> Símbolo </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{ element.symbol }} </mat-cell>
              </ng-container>
              <!-- Name Column -->
              <ng-container matColumnDef="value">
                <mat-header-cell *matHeaderCellDef> Precio </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{ element.closePrice }} </mat-cell>
              </ng-container>

              <!-- Description Column -->
              <ng-container matColumnDef="date">
                <mat-header-cell *matHeaderCellDef> Fecha </mat-header-cell>
                <mat-cell *matCellDef="let element"> {{ element.date | date }} </mat-cell>
              </ng-container>

              <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
              <mat-row matRipple *matRowDef="let row; columns: displayedColumns;"></mat-row>
            </mat-table>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions align="end">
        <button mat-raised-button color="primary" (click)="fetchStocksFromBVC()" [disabled]="isLoading">Refrescar</button>
      </mat-card-actions>
    </mat-card>
  </div>
  <br/>
  <div class="row" style="height: 500px">
    <mat-card>
      <div class="row">
        <mat-card-title>Histórico</mat-card-title>
        <mat-card-content>
          <form [formGroup]="form">
            <div class="row">
              <mat-form-field appearance="outline">
                <mat-label>T&iacute;tulo</mat-label>
                <input placeholder="Título"
                       aria-label="Título'"
                       matInput
                       formControlName="title"
                       [matAutocomplete]="auto" required>
                <mat-autocomplete #auto="matAutocomplete"  [displayWith]="getOptionText">
                  <mat-option *ngFor="let title of filteredTitles | async" [value]="title">
                    {{ title.symbol }}<span *ngIf="title.name"> | {{ title.name }}</span>
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <div class="text-center">
              <mat-button-toggle-group formControlName="interval" appearance="legacy">
                <mat-button-toggle value="1w">1W</mat-button-toggle>
                <mat-button-toggle value="1month">1M</mat-button-toggle>
                <mat-button-toggle value="3month">3M</mat-button-toggle>
                <mat-button-toggle value="6month">6M</mat-button-toggle>
                <mat-button-toggle value="1y">1Y</mat-button-toggle>
                <mat-button-toggle value="5y">5Y</mat-button-toggle>
                <mat-button-toggle value="all">TODO</mat-button-toggle>
              </mat-button-toggle-group>
            </div>
          </form>

          <canvas id="chart" height="500" class="col-12"></canvas>
        </mat-card-content>
      </div>

      <br/>
      <div class="row">
        <mat-card-title>Predicción</mat-card-title>
        <mat-card-content>
          <canvas id="predictionChart" height="500" class="col-12"></canvas>
        </mat-card-content>
      </div>
    </mat-card>
  </div>
  <br/>
</div>
